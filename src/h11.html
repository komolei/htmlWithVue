<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- set `maximum-scale` for some compatibility issues -->
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <!-- 启用360浏览器的极速模式(webkit) -->
    <meta name="renderer" content="webkit">
    <!-- 避免IE使用兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓 -->
    <meta name="HandheldFriendly" content="true">
    <!-- 微软的老式浏览器 -->
    <meta name="MobileOptimized" content="320">
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- UC应用模式 -->
    <meta name="browsermode" content="application">
    <!-- QQ应用模式 -->
    <meta name="x5-page-mode" content="app">
    <!-- windows phone 点击无高光 -->
    <meta name="msapplication-tap-highlight" content="no">
    <title>
        <%=htmlWebpackPlugin.options.title %>
    </title>
    <link rel="shortcut icon" type="image/x-icon" href="//appybrencdn.oss-cn-hangzhou.aliyuncs.com/PC/web/favicon.ico"
        media="screen">
    <!-- <script src="https://as.alipayobjects.com/g/component/fastclick/1.0.6/fastclick.js"></script> -->
    <!-- 阿里高清方案 -->
    <!-- <script>!function (e) { function t(a) { if (i[a]) return i[a].exports; var n = i[a] = { exports: {}, id: a, loaded: !1 }; return e[a].call(n.exports, n, n.exports, t), n.loaded = !0, n.exports } var i = {}; return t.m = e, t.c = i, t.p = "", t(0) }([function (e, t) { "use strict"; Object.defineProperty(t, "__esModule", { value: !0 }); var i = window; t["default"] = i.flex = function (e, t) { var a = e || 100, n = t || 1, r = i.document, o = navigator.userAgent, d = o.match(/Android[\S\s]+AppleWebkit\/(\d{3})/i), l = o.match(/U3\/((\d+|\.){5,})/i), c = l && parseInt(l[1].split(".").join(""), 10) >= 80, p = navigator.appVersion.match(/(iphone|ipad|ipod)/gi), s = i.devicePixelRatio || 1; p || d && d[1] > 534 || c || (s = 1); var u = 1 / s, m = r.querySelector('meta[name="viewport"]'); m || (m = r.createElement("meta"), m.setAttribute("name", "viewport"), r.head.appendChild(m)), m.setAttribute("content", "width=device-width,user-scalable=no,initial-scale=" + u + ",maximum-scale=" + u + ",minimum-scale=" + u), r.documentElement.style.fontSize = a / 2 * s * n + "px" }, e.exports = t["default"] }]);
        flex(100, 1);
    </script> -->
    <!-- <script src="https://cdn.bootcss.com/babel-polyfill/7.0.0-rc.4/polyfill.min.js"></script> -->

</head>

<body>

    <!-- <div class="leftCt">
        xxx
    </div> -->
    <div id="app">
        <div class="mask">
            <div class="loader">
                <span class="loader-block"></span>
                <span class="loader-block"></span>
                <span class="loader-block"></span>
                <span class="loader-block"></span>
                <span class="loader-block"></span>
                <span class="loader-block"></span>
                <span class="loader-block"></span>
                <span class="loader-block"></span>
                <span class="loader-block"></span>
            </div>
        </div>
        <div class="ct">
            <div class="nav">
                <div class="command">
                    筛选客户：
                </div>
                <div class="sel_command">
                    <div class="tab1 show_border">累计消费金额</div>
                    <div class="tab2">现金余额</div>
                    <div class="tab3">最近购买时间</div>
                    <div class="tab4">下次联系时间</div>
                </div>
            </div>
            <div class="content">
                <div class="top">
                    <span class="btn_all">全部</span>
                    <div class="down_ct hide">
                        <div class="triangle"></div>
                        <ul class="downNav">
                            <li class="select_li">全部</li>
                            <li>未联系</li>
                            <li>同意充值</li>
                            <li>拒绝充值</li>
                            <li>下次联系</li>
                        </ul>
                    </div>
                </div>
                <div class="tab_loading">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="42" height="42" fill="white">
                        <circle transform="translate(8 0)" cx="0" cy="16" r="0" stroke='#111'>
                            <animate attributeName="r" values="0; 4; 0; 0" dur="1.2s" repeatCount="indefinite" begin="0"
                                keytimes="0;0.2;0.7;1" keySplines="0.2 0.2 0.4 0.8;0.2 0.6 0.4 0.8;0.2 0.6 0.4 0.8"
                                calcMode="spline" />
                        </circle>
                        <circle transform="translate(16 0)" cx="0" cy="16" r="0" stroke='#111'>
                            <animate attributeName="r" values="0; 4; 0; 0" dur="1.2s" repeatCount="indefinite" begin="0.3"
                                keytimes="0;0.2;0.7;1" keySplines="0.2 0.2 0.4 0.8;0.2 0.6 0.4 0.8;0.2 0.6 0.4 0.8"
                                calcMode="spline" />
                        </circle>
                        <circle transform="translate(24 0)" cx="0" cy="16" r="0" stroke='#111'>
                            <animate attributeName="r" values="0; 4; 0; 0" dur="1.2s" repeatCount="indefinite" begin="0.6"
                                keytimes="0;0.2;0.7;1" keySplines="0.2 0.2 0.4 0.8;0.2 0.6 0.4 0.8;0.2 0.6 0.4 0.8"
                                calcMode="spline" />
                        </circle>
                    </svg>
                </div>
                <div class="wrapper_ct">
                    <div class="wrapper0" id="wrapper0">
                        <ul class="content">

                        </ul>
                    </div>
                    <div class="wrapper1 hide" id="wrapper1">
                        <ul class="content">
                        </ul>
                    </div>
                    <div class="wrapper2 hide" id="wrapper1">
                        <ul class="content">

                        </ul>
                    </div>
                    <div class="wrapper3 hide" id="wrapper1">
                        <ul class="content">

                        </ul>
                    </div>
                </div>

            </div>
        </div>

        <div class="svg_ct">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="42" height="42" fill="white">
                <circle transform="translate(8 0)" cx="0" cy="16" r="0" stroke='#111'>
                    <animate attributeName="r" values="0; 4; 0; 0" dur="1.2s" repeatCount="indefinite" begin="0"
                        keytimes="0;0.2;0.7;1" keySplines="0.2 0.2 0.4 0.8;0.2 0.6 0.4 0.8;0.2 0.6 0.4 0.8" calcMode="spline" />
                </circle>
                <circle transform="translate(16 0)" cx="0" cy="16" r="0" stroke='#111'>
                    <animate attributeName="r" values="0; 4; 0; 0" dur="1.2s" repeatCount="indefinite" begin="0.3"
                        keytimes="0;0.2;0.7;1" keySplines="0.2 0.2 0.4 0.8;0.2 0.6 0.4 0.8;0.2 0.6 0.4 0.8" calcMode="spline" />
                </circle>
                <circle transform="translate(24 0)" cx="0" cy="16" r="0" stroke='#111'>
                    <animate attributeName="r" values="0; 4; 0; 0" dur="1.2s" repeatCount="indefinite" begin="0.6"
                        keytimes="0;0.2;0.7;1" keySplines="0.2 0.2 0.4 0.8;0.2 0.6 0.4 0.8;0.2 0.6 0.4 0.8" calcMode="spline" />
                </circle>
            </svg>
        </div>

    </div>
    <div class="custom_ct hide">
        <div class="custom">
            <div class="top">
                请设置客户状态
            </div>
            <div class="middle">
                <label for="no_contact">
                    <div class="icon_ct">
                        <input type="radio" name="custom_status" id="no_contact" value="未联系" checked="checked" onchange="handlerSelectTime()">
                        <span class="icon_check"></span>
                    </div>
                    <div class="text">未联系</div>
                </label>
                <label for="next_contact">
                    <div class="icon_ct">
                        <input type="radio" name="custom_status" id="next_contact" value="下次联系" onchange="handlerNextContact()">
                        <span class="icon_check"></span>
                    </div>
                    <div class="text">下次联系</div>
                </label>
                <label for="agree_pay">
                    <div class="icon_ct">
                        <input type="radio" name="custom_status" id="agree_pay" value="同意充值" onchange="handlerSelectTime()">
                        <span class="icon_check"></span>
                    </div>
                    <div class="text">同意充值</div>
                </label>
                <label for="adjust_pay">
                    <div class="icon_ct">
                        <input type="radio" name="custom_status" id="adjust_pay" value="拒绝充值" onchange="handlerSelectTime()">
                        <span class="icon_check"></span>
                    </div>
                    <div class="text">拒绝充值</div>
                </label>
            </div>
            <div class="select_time hide">
                <div class="top">
                    设置下次联系时间
                </div>
                <div class="time_box">
                    <div class="time">2018-11-09</div>
                    <div class="time show_time">2018-11-10</div>
                    <div class="time">2018-11-11</div>
                </div>
            </div>
            <div class="remark">
                添加备注（<span>0</span>/20）
            </div>
            <div class="remark_input">
                <input type="text">
            </div>
            <div class="bottom">
                <div class="btn_cancel" onclick="handlerContact()">取消</div>
                <div class="btn_sure" onclick="sureEditInfo()">确定</div>
            </div>
        </div>
    </div>
    <div class="pay_ct hide">
        <div class="pay_record">
            <div class="top">
                充值记录
            </div>
            <div class="middle">
                <table>
                    <tbody>
                        <!-- <tr>
                            <th>充值时间</th>
                            <th>充值金额（元）</th>
                        </tr> -->
                        <!-- <div class="pay_record_div">
                            <div class="pay_record_ct">

                            </div>
                        </div> -->
                    </tbody>
                </table>
            </div>
            <div class="bottom">
                <div class="cancel" onclick="closedPayRecord()">关闭</div>
            </div>
        </div>
    </div>
</body>

<script src="https://ossstatic.ybren.com/Wx/Public/js/jquery.1.7.2.min.js"></script>
<script src="https://ossstatic.ybren.com/Wx/Public/js/app_function.js"></script>
<script src="https://ossstatic.ybren.com/Wx/Public/js/jquery.openapp.js"></script>
<script src="https://ossstatic.ybren.com/Public/js/noncestamp.js?v=1"></script>
<script src="https://ossstatic.ybren.com/App/Public/Home/js/alert.js"></script>

<!-- <script src="./static/pulltorefresh.js"></script> -->
<!-- <script src="https://cdn.bootcss.com/pulltorefreshjs/0.1.14/pulltorefresh.js"></script> -->
<!-- <script src="https://appybrencdn.oss-cn-hangzhou.aliyuncs.com/Wx/komolei/lib/bscroll.min.js"></script> -->


<script>

    document.ready = function () {
        setTimeout(() => {
            $('.mask').fadeOut()
        }, 1000);
        $('.tab_loading').fadeOut();

    }
    var reqUrl = "https://apptest.ybren.com/index.php/";
    //
    var $_GET = (function () {
        var url = window.document.location.href.toString();
        var u = url.split("?");
        if (typeof (u[1]) == "string") {
            u = u[1].split("&");
            var get = {};
            for (var i in u) {
                var j = u[i].split("=");
                get[j[0]] = j[1];
            }
            return get;
        } else {
            return {};
        }
    })();
    var LoginToken = $_GET['LoginToken']
    var g_type = 1,
        g_filter = 1,
        g_count = 6, g_position = 1;
    var g_isLock = false;
    var g_userId;
    // btn click event

    function tabSelect(ct, className) {
        $(ct).on('click', function (e) {
            if (e.target && e.target.tagName.toLocaleLowerCase() == 'div') {
                $.each($(ct + '>div'), function (index, el) {
                    $(this).removeClass(className)
                })
            }
            e.target.classList.add(className)
            $('.tab_loading').fadeIn();
            let index = $(ct + '>div').index(e.target);
            g_type = index;
            if (g_position > 1) { g_position = 1 }
            $.each($('.wrapper_ct>div'), function () {
                $(this).fadeOut()
            })
            $('.wrapper' + index).fadeIn()
            g_isLock = false;
            handlerTab(g_count, g_position, index + 1, $('.downNav>li').index($('.select_li')) + 1)
        })
    }

    tabSelect('.sel_command', 'show_border')

    function getPayRecord(UserId) {
        apiPost(reqUrl + "/H5Eleven2018/getRechargeList", {
            "LoginToken": LoginToken,
            "userId": UserId,
        }, function (data) {
            // var str=data
            if (data.Status) {
                if (data.Data.length > 0) {
                    var str = data.Data.map(item => {
                        return '<tr>' +
                            '<td>' + item.CJSJ + '</td>' +
                            '<td>' + item.JE + '</td>' +
                            '</tr>'
                    })
                    var newStr = ' <tr>' +
                        '<th>充值时间</th>' +
                        '<th>充值金额（元）</th>' +
                        '</tr>'
                    str.unshift(newStr)
                    $('.pay_record .middle tbody').html(str.join(''));
                    // $('.pay_record_div').html(newStr.join(''));
                } else {
                    var str = ' <tr>' +
                        '<th>充值时间</th>' +
                        '<th>充值金额（元）</th>' +
                        '</tr>' + '<tr>' +
                        '<td></td>' +
                        '<td></td>' +
                        '</tr>'
                    // $('.pay_record_ct').html(str);
                    $('.pay_record .middle tbody').html(str.join(''));

                }

            } else {
                jqueryAlert({
                    'content': data['ErrorMsg'],
                    'closeTime': 1000
                })
            }
            $('.tab_loading').fadeOut();

        }, false);
    }

    function handlerTab(Count, Position, type, filter) {
        g_count = Count;
        g_position = Position;
        g_type = type;
        // $('.svg_ct').show();
        if (g_isLock) return $('.svg_ct').fadeOut();
        apiPost(reqUrl + "/H5Eleven2018/Eleven2018List", {
            "LoginToken": LoginToken,
            "Count": Count,
            "Position": Position,
            "type": type,
            "filter": filter,
        }, function (data) {
            if (data.Status) {
                if (g_position > 1) {
                    if (data.Data.length > 0) {
                        var str = data.Data.map(item => {
                            return '<li><div class="title">' +
                                '<div class="left">' + item.G_XM + '-' + item.G_XB + '-' + item.G_SJHM +
                                '</div>' +
                                '<div class="right">' +
                                '<button onclick="getEditInfo(' + item.G_GKBH + ')">' + item.G_SFLX + '</button>' +
                                '<div>' + item.XCLXSJ + '</div>' +
                                '<div class="img_ct">' +
                                '<img class="img_all" src="https://appybrencdn.oss-cn-hangzhou.aliyuncs.com/Wx/komolei/images/icon_hdbjzt%402x.png">' +
                                '</div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="content_c">' +
                                '<div class="left">' +
                                '<p>' +
                                '<span class="text_1">' +
                                '现金余额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_QBYE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '活动余额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_HDYE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '累计消费金额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_LJXFJE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '备注：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_BZ +
                                '</span>' +
                                '</p>' +
                                '<div class="btns">' +
                                '<div class="btn_history" onclick="handlerHistoryOrder(' + JSON.stringify(item).replace(/"/g, '&quot;') + ')">历史订单</div>' +
                                '<div class="record" onclick="handlerPayRecord(' + item.G_GKBH + ')">充值记录</div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="right">' +
                                '<p>' +
                                '<span class="text_1">' +
                                '购买频次：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_LJXFCS + '次' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '最近消费时间：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_ZJYCXF +
                                '</span>' +
                                '</p>' +
                                '</div>' +
                                '</div>' + '</li>'
                        })
                        $('.wrapper' + (g_type - 1) + ' > .content').append(str.join(''));
                    } else {
                        // $('.wrapper' + (g_type - 1) + ' > .content').append('<div style="text-align:center">暂无数据...</div>');
                        jqueryAlert({
                            'content': '暂无数据...',
                            'closeTime': 1000
                        })
                        g_isLock = true;
                        $('.svg_ct').fadeOut();
                    }
                } else {
                    if (data.Data.length > 0) {
                        var str = data.Data.map(item => {
                            return '<li><div class="title">' +
                                '<div class="left">' + item.G_XM + '-' + item.G_XB + '-' + item.G_SJHM +
                                '</div>' +
                                '<div class="right">' +
                                '<button onclick="getEditInfo(' + item.G_GKBH + ')">' + item.G_SFLX + '</button>' +
                                '<div>' + item.XCLXSJ + '</div>' +
                                '<div class="img_ct">' +
                                '<img class="img_all" src="https://appybrencdn.oss-cn-hangzhou.aliyuncs.com/Wx/komolei/images/icon_hdbjzt%402x.png">' +
                                '</div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="content_c">' +
                                '<div class="left">' +
                                '<p>' +
                                '<span class="text_1">' +
                                '现金余额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_QBYE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '活动余额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_HDYE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '累计消费金额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_LJXFJE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '备注：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_BZ +
                                '</span>' +
                                '</p>' +
                                '<div class="btns">' +
                                '<div class="btn_history" onclick="handlerHistoryOrder(' + JSON.stringify(item).replace(/"/g, '&quot;') + ')">历史订单</div>' +
                                '<div class="record" onclick="handlerPayRecord(' + item.G_GKBH + ')">充值记录</div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="right">' +
                                '<p>' +
                                '<span class="text_1">' +
                                '购买频次：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_LJXFCS + '次' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '最近消费时间：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_ZJYCXF +
                                '</span>' +
                                '</p>' +
                                '</div>' +
                                '</div>' + '</li>'
                        })
                        $('.wrapper' + (g_type - 1) + ' > .content').html(str.join(''));
                    } else {
                        // $('.wrapper' + (g_type - 1) + ' > .content').append('<div style="text-align:center">暂无数据...</div>');
                        jqueryAlert({
                            'content': '暂无数据...',
                            'closeTime': 1000
                        })
                        g_isLock = true;
                        $('.svg_ct').fadeOut();
                    }
                }
            } else {
                jqueryAlert({
                    'content': data['ErrorMsg'],
                    'closeTime': 1000
                })
            }
            $('.tab_loading').fadeOut();

        }, false);
    }

    // document ready invoke 
    handlerTab(6, 1, 1, 1)

    function handlerHistoryOrder(item) {
        var userName = item.G_XM, gender = item.G_XB, cellPhone = item.G_SJHM, userId = item.G_GKBH;
        var str = 'VC=YBRHistoryOrderViewController&userName=' + userName + '&gender=' + gender + '&cellPhone=' + cellPhone + '&userId=' + userId;
        var newStr = encodeURI(str)
        console.log(newStr);
        showHtmlcallNative(888, newStr, 888);
    }

    function handlerTabofEditInfo(Count, Position, type, filter) {
        g_count = Count;
        g_position = Position;
        g_type = type;
        // $('.svg_ct').show();
        if (g_isLock) return $('.svg_ct').fadeOut();
        apiPost(reqUrl + "/H5Eleven2018/Eleven2018List", {
            "LoginToken": LoginToken,
            "Count": Count,
            "Position": Position,
            "type": type,
            "filter": filter,
        }, function (data) {
            if (data.Status) {
                if (data.Data.length > 0) {
                    var str = data.Data.map(item => {
                        return '<li><div class="title">' +
                            '<div class="left">' + item.G_XM + '-' + item.G_XB + '-' + item.G_SJHM +
                            '</div>' +
                            '<div class="right">' +
                            '<button onclick="getEditInfo(' + item.G_GKBH + ')">' + item.G_SFLX + '</button>' +
                            '<div>' + item.XCLXSJ + '</div>' +
                            '<div class="img_ct">' +
                            '<img class="img_all" src="https://appybrencdn.oss-cn-hangzhou.aliyuncs.com/Wx/komolei/images/icon_hdbjzt%402x.png">' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '<div class="content_c">' +
                            '<div class="left">' +
                            '<p>' +
                            '<span class="text_1">' +
                            '现金余额：' +
                            '</span>' +
                            '<span class="text_2">' +
                            item.G_QBYE + '元' +
                            '</span>' +
                            '</p>' +
                            '<p>' +
                            '<span class="text_1">' +
                            '活动余额：' +
                            '</span>' +
                            '<span class="text_2">' +
                            item.G_HDYE + '元' +
                            '</span>' +
                            '</p>' +
                            '<p>' +
                            '<span class="text_1">' +
                            '累计消费金额：' +
                            '</span>' +
                            '<span class="text_2">' +
                            item.S_LJXFJE + '元' +
                            '</span>' +
                            '</p>' +
                            '<p>' +
                            '<span class="text_1">' +
                            '备注：' +
                            '</span>' +
                            '<span class="text_2">' +
                            item.G_BZ +
                            '</span>' +
                            '</p>' +
                            '<div class="btns">' +
                            '<div class="btn_history" onclick="handlerHistoryOrder(' + JSON.stringify(item).replace(/"/g, '&quot;') + ')">历史订单</div>' +
                            '<div class="record" onclick="handlerPayRecord(' + item.G_GKBH + ')">充值记录</div>' +
                            '</div>' +
                            '</div>' +
                            '<div class="right">' +
                            '<p>' +
                            '<span class="text_1">' +
                            '购买频次：' +
                            '</span>' +
                            '<span class="text_2">' +
                            item.S_LJXFCS + '次' +
                            '</span>' +
                            '</p>' +
                            '<p>' +
                            '<span class="text_1">' +
                            '最近消费时间：' +
                            '</span>' +
                            '<span class="text_2">' +
                            item.S_ZJYCXF +
                            '</span>' +
                            '</p>' +
                            '</div>' +
                            '</div>' + '</li>'
                    })
                    $('.wrapper' + (g_type - 1) + ' > .content').html(str.join(''));
                } else {
                    // $('.wrapper' + (g_type - 1) + ' > .content').append('<div style="text-align:center">暂无数据...</div>');
                    jqueryAlert({
                        'content': '暂无数据...',
                        'closeTime': 1000
                    })
                    g_isLock = true;
                    $('.svg_ct').fadeOut();
                }

            } else {
                jqueryAlert({
                    'content': data['ErrorMsg'],
                    'closeTime': 1000
                })
            }
            $('.tab_loading').fadeOut();

        }, false);
    }

    // userId
    function editInfo(UserId) {
        var status = $('input[name="custom_status"]').index($('input[name="custom_status"]:checked'))
        var time = status == 1 ? $('.time.show_time').text() : ''
        apiPost(reqUrl + "/H5Eleven2018/editInfo", {
            "LoginToken": LoginToken,
            "userId": UserId,
            'status': status + 1,
            'contactDate': time,
            'remark': $('.remark_input input').val()
        }, function (data) {
            // var str=data
            if (data.Status) {
                jqueryAlert({
                    'content': '编辑成功',
                    'closeTime': 1000
                })
                handlerTabofEditInfo(g_count, g_position, g_type, g_filter)
            } else {
                jqueryAlert({
                    'content': data['ErrorMsg'],
                    'closeTime': 1000
                })
            }
            $('.custom_ct').fadeToggle()
            $('.tab_loading').fadeOut();

        }, false);
    }

    function getEditInfo(UserId) {
        g_userId = UserId;
        apiPost(reqUrl + "/H5Eleven2018/getEditInfo", {
            "LoginToken": LoginToken,
            "userId": UserId,
        }, function (data) {
            // var str=data
            if (data.Status) {
                if (JSON.stringify(data.Data) != '{}') {
                    var newData = data.Data;
                    var index = newData.G_SFLX == null ? 0 : Number(newData.G_SFLX) - 1
                    $('input[name="custom_status"]').eq(index).attr("checked", "checked");
                    if (newData.G_SFLX != null && Number(newData.G_SFLX) == 2) {
                        $('.select_time').fadeIn()
                        $.each($('.time_box div'), function (index, el) {
                            $(el).removeClass('show_time')
                            if ($(el).text() == newData.XCLXSJ) {
                                $('.time_box div').eq(index).addClass('show_time')
                            }
                        })
                    } else {
                        $('.select_time').hide()
                    }
                    $('.remark_input input').val(newData.G_BZ);
                    $('.remark>span').text(newData.G_BZ.length.toString())
                    handlerContact()

                } else {
                    handlerContact()
                }
                // jqueryAlert({
                //     'content': '编辑成功',
                //     'closeTime': 1000
                // })
            } else {
                jqueryAlert({
                    'content': data['ErrorMsg'],
                    'closeTime': 1000
                })
            }
            $('.tab_loading').fadeOut();

        }, false);
    }

    function handlerInput() {
        var length = $(this).val().length;
        if (length >= 20) {
            $(this).val($(this).val().substr(0, 20))
        }
        $('.remark>span').text(length.toString())
    }
    $('.remark_input input').on('input', handlerInput)

    function sureEditInfo() {
        editInfo(g_userId)
    }

    $('.top>.btn_all').on('touchstart', function (e) {
        e.stopPropagation()
        $('.down_ct').fadeIn()
    })

    $('body').on('click', function (e) {
        if (e.target && e.target.className.toLocaleLowerCase() != 'btn_all' && e.target.className.toLocaleLowerCase() !=
            'down_ct' && e.target.tagName.toLocaleLowerCase() != 'li' && $('.down_ct').css('display') ==
            'block') {
            $('.down_ct').fadeOut();
        }
    })

    $('.down_ct').on('touchend', function (e) {
        e.stopPropagation()
        $(this).fadeOut();
    })

    function singleSelect(ct, className) {
        $(ct).on('click', function (e) {
            if (e.target && e.target.tagName.toLocaleLowerCase() == 'div') {
                $.each($(ct + '>div'), function (index, el) {
                    $(this).removeClass(className)
                })
            }
            e.target.classList.add(className)
        })
    }
    singleSelect('.time_box', "show_time")

    tabLoading_toggle()
    // downnav 
    function handlerTabOfDownNav(Count, Position, type, filter) {
        g_count = Count;
        g_position = Position;
        g_type = type;
        // $('.svg_ct').show();
        if (g_isLock) return $('.svg_ct').fadeOut();
        apiPost(reqUrl + "/H5Eleven2018/Eleven2018List", {
            "LoginToken": LoginToken,
            "Count": Count,
            "Position": Position,
            "type": type,
            "filter": filter,
        }, function (data) {
            // var str=data
            if (data.Status) {
                if (g_position > 1) {
                    if (data.Data.length > 0) {
                        var str = data.Data.map(item => {
                            return '<li><div class="title">' +
                                '<div class="left">' + item.G_XM + '-' + item.G_XB + '-' + item.G_SJHM +
                                '</div>' +
                                '<div class="right">' +
                                '<button onclick="getEditInfo(' + item.G_GKBH + ')">' + item.G_SFLX + '</button>' +
                                '<div>' + item.XCLXSJ + '</div>' +
                                '<div class="img_ct">' +
                                '<img class="img_all" src="https://appybrencdn.oss-cn-hangzhou.aliyuncs.com/Wx/komolei/images/icon_hdbjzt%402x.png">' +
                                '</div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="content_c">' +
                                '<div class="left">' +
                                '<p>' +
                                '<span class="text_1">' +
                                '现金余额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_QBYE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '活动余额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_HDYE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '累计消费金额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_LJXFJE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '备注：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_BZ +
                                '</span>' +
                                '</p>' +
                                '<div class="btns">' +
                                '<div class="btn_history" onclick="handlerHistoryOrder(' + JSON.stringify(item).replace(/"/g, '&quot;') + ')">历史订单</div>' +
                                '<div class="record" onclick="handlerPayRecord(' + item.G_GKBH + ')">充值记录</div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="right">' +
                                '<p>' +
                                '<span class="text_1">' +
                                '购买频次：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_LJXFCS + '次' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '最近消费时间：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_ZJYCXF +
                                '</span>' +
                                '</p>' +
                                '</div>' +
                                '</div>' + '</li>'
                        })
                        $('.wrapper' + (g_type - 1) + ' > .content').append(str.join(''));
                    } else {
                        $('.wrapper' + (g_type - 1) + ' > .content').html('');

                        // $('.wrapper' + (g_type - 1) + ' > .content').append('<div style="text-align:center">暂无数据...</div>');
                        jqueryAlert({
                            'content': '暂无数据...',
                            'closeTime': 1000
                        })
                        g_isLock = true;
                        $('.svg_ct').fadeOut();
                    }
                } else {
                    if (data.Data.length > 0) {
                        var str = data.Data.map(item => {
                            return '<li><div class="title">' +
                                '<div class="left">' + item.G_XM + '-' + item.G_XB + '-' + item.G_SJHM +
                                '</div>' +
                                '<div class="right">' +
                                '<button onclick="getEditInfo(' + item.G_GKBH + ')">' + item.G_SFLX + '</button>' +
                                '<div>' + item.XCLXSJ + '</div>' +

                                '<div class="img_ct">' +
                                '<img class="img_all" src="https://appybrencdn.oss-cn-hangzhou.aliyuncs.com/Wx/komolei/images/icon_hdbjzt%402x.png">' +
                                '</div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="content_c">' +
                                '<div class="left">' +
                                '<p>' +
                                '<span class="text_1">' +
                                '现金余额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_QBYE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '活动余额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_HDYE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '累计消费金额：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_LJXFJE + '元' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '备注：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.G_BZ +
                                '</span>' +
                                '</p>' +
                                '<div class="btns">' +
                                '<div class="btn_history" onclick="handlerHistoryOrder(' + JSON.stringify(item).replace(/"/g, '&quot;') + ')">历史订单</div>' +
                                '<div class="record" onclick="handlerPayRecord(' + item.G_GKBH + ')">充值记录</div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="right">' +
                                '<p>' +
                                '<span class="text_1">' +
                                '购买频次：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_LJXFCS + '次' +
                                '</span>' +
                                '</p>' +
                                '<p>' +
                                '<span class="text_1">' +
                                '最近消费时间：' +
                                '</span>' +
                                '<span class="text_2">' +
                                item.S_ZJYCXF +
                                '</span>' +
                                '</p>' +
                                '</div>' +
                                '</div>' + '</li>'
                        })
                        $('.wrapper' + (g_type - 1) + ' > .content').html(str.join(''));
                    } else {
                        $('.wrapper' + (g_type - 1) + ' > .content').html('');

                        // $('.wrapper' + (g_type - 1) + ' > .content').append('<div style="text-align:center">暂无数据...</div>');
                        jqueryAlert({
                            'content': '暂无数据...',
                            'closeTime': 1000
                        })
                        g_isLock = true;
                        $('.svg_ct').fadeOut();
                    }
                }


            } else {
                jqueryAlert({
                    'content': data['ErrorMsg'],
                    'closeTime': 1000
                })
            }
            $('.tab_loading').fadeOut();
            $('.svg_ct').fadeOut();

        }, false);
    }

    $('.downNav').on('click', function (e) {
        if (e.target && e.target.tagName.toLocaleLowerCase() == 'li') {
            $.each($('.downNav>li'), function (index, el) {
                $(this).removeClass('select_li')
            })
        }
        e.target.classList.add('select_li')
        let index = $('.downNav>li').index(e.target) + 1;
        g_filter = index;
        $('.btn_all').text($(e.target).text())
        g_isLock = false;
        g_position = 1;
        handlerTabOfDownNav(g_count, g_position, $('.sel_command> div').index($('.show_border')) + 1, index)
    })


    function tabLoading_toggle() {
        $('.tab_loading').fadeToggle()
    }

    // open pay record modal
    function handlerPayRecord(userId) {
        $('.pay_ct').fadeToggle();
        getPayRecord(userId)
        // getPayRecord('10208808')
    }
    function closedPayRecord() {
        $('.pay_ct').fadeToggle();

    }

    // close pay record modal
    function handlerContact(content) {
        $('.custom_ct').fadeToggle()
    }
    // function handlerContactOfCustom(userId){
    //     getEditInfo(userId)
    // }
    function handlerSelectTime() {
        $('.select_time').fadeOut();
    }


    $('.custom_ct').on('click', function (e) {
        // if (e.target && e.target.className.toLocaleLowerCase() != 'custom') {
        //     $('.custom_ct').fadeOut()
        // }
        e.stopPropagation();
    })

    function handlerNextContact() {
        $('.select_time').fadeIn()
    }

    // debounce
    function debounce(func, wait, immediate) {

        var timeout, result;

        var debounced = function () {
            var context = this;
            var args = arguments;

            if (timeout) clearTimeout(timeout);
            if (immediate) {
                // 如果已经执行过，不再执行
                var callNow = !timeout;
                timeout = setTimeout(function () {
                    timeout = null;
                }, wait)
                if (callNow) result = func.apply(context, args)
            }
            else {
                timeout = setTimeout(function () {
                    func.apply(context, args)
                }, wait);
            }
            return result;
        };

        debounced.cancel = function () {
            clearTimeout(timeout);
            timeout = null;
        };

        return debounced;
    }
    //获取滚动条当前的位置 
    function getScrollTop() {
        var scrollTop = 0;
        if (document.documentElement && document.documentElement.scrollTop) {
            scrollTop = document.documentElement.scrollTop;
        } else if (document.body) {
            scrollTop = document.body.scrollTop;
        }
        return scrollTop;
    }

    //获取当前可视范围的高度 
    function getClientHeight() {
        var clientHeight = 0;
        if (document.body.clientHeight && document.documentElement.clientHeight) {
            clientHeight = Math.min(document.body.clientHeight, document.documentElement.clientHeight);
        } else {
            clientHeight = Math.max(document.body.clientHeight, document.documentElement.clientHeight);
        }
        return clientHeight;
    }

    //获取文档完整的高度 
    function getScrollHeight() {
        return Math.max(document.body.scrollHeight, document.documentElement.scrollHeight);
    }
    window.onscroll = function () {
        if (getScrollTop() + getClientHeight() == getScrollHeight()) {
            $('.svg_ct').removeClass('hide')
            // $('.wrapper>.content').append(`<li>xxx</li>`)
            debounce(handlerTab(g_count, g_position + 1, g_type, g_filter), 1000, true)
            // setTimeout(() => {

            //     handlerTab(g_count, g_position + 1, g_type, g_filter)
            // }, 1000);
            // handlerTab(g_count+1, g_position, g_type, g_filter)
        } else {
            $('.svg_ct').addClass('hide');
        }
    }


</script>
</html>